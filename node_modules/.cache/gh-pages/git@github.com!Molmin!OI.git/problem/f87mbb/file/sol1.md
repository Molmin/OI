因为 $m=n-1$ 或 $m=n$，所以本题的构成的图为一棵基环树或普通树。

**【定义】** 基环树中，对于环上结点，称相邻的环上的结点为父亲结点，其余向另结点为儿子结点。

考虑动态规划。

记 $\text{fa}_u$ 表示结点 $u$ 的父亲结点个数；$\text{son}_u$ 表示结点 $u$ 的儿子结点个数；$w_{u-v}$ 表示结点 $u$ 和 $v$。

记状态 $\text{up}_ u$ 表示以结点 $u$ 为起点，第一步向父亲结点走，最终的期望路径长度；状态 $\text{down}_ u$ 表示以结点 $u$ 为起点，第一步向儿子结点走，最终的期望路径长度。

下面先考虑普通树的做法。