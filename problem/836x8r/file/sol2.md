考虑枚举结点 $w$，那么贡献就是与 $w$ 相邻的结点的权值两两之积。但是要减去两点已经有边的情况。此情况类似于三元环计数，只需遍历三元环即可。

对于最大值部分，同样考虑直接枚举 $w$，再枚举 $w$ 的相邻结点作为 $u,\ v$ 即可。但是由于我们只需要找到最大值，所以可以按照点权进行排序，从大到小找到第一个合法的三元组即可。而由于只有遇到三元环才会往更小的找，所以时间复杂度等价于三元环个数。

时间复杂度 $\Theta(m\sqrt m)$（假设 $n,\ m$ 同阶）。