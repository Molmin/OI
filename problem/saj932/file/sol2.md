考虑树状数组维护每个前缀有多少在当前值域范围的数，然后二分位置寻找中项。

但是每次进入函数都需要重新构建树状数组，这大大增加了算法的复杂度。

考虑取得中项后，值域区间分为长短两段。先把短的那段从树状数组删除，然后求解长的那一段（此时无需重新构建树状数组）；接着求解短的那段（此时需要重新构建树状数组）。

时间复杂度 $O(n\log^3 n)$。